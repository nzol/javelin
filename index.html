<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JAVELIN</title>

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/datepicker3.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet">

<!--Icons-->
<script src="js/lumino.glyphs.js"></script>
<script src="jquery.js"></script>
<script src="jquerym.js"></script>
<script src="cordova.js"></script>

<script type="text/javascript">
$( function() {
     document.addEventListener("deviceready", onAppLoad, false);
});
</script>

</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#" onclick="onAppLoad()">JAVELIN</a>
				<ul class="user-menu">
					<li class="dropdown pull-right">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> My Account</a></li>
							<li><a href="#" onclick="onAppLoad()"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Manual Sequence</a></li>
							<li><a href="#" onclick="alert(getLocalVar('javelin_products'))"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Change Domain</a></li>
							<li><a href="#" onclick="alert(getLocalVar('javelin_products'))"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Show Product Data</a></li>
							<li><a href="#" onclick="showScreen('logout');"><svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg> Logout</a></li>
						</ul>
					</li>
				</ul>
			</div>
							
		</div><!-- /.container-fluid -->
	</nav>
		
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar" style="display:none;">
		<form role="search">
			<div class="form-group">
				<input type="text" class="form-control" placeholder="Search">
			</div>
		</form>
		<ul class="nav menu">
			<li class="active"><a href="index.html"><svg class="glyph stroked dashboard-dial"><use xlink:href="#stroked-dashboard-dial"></use></svg> Dashboard</a></li>
			<li><a href="widgets.html"><svg class="glyph stroked calendar"><use xlink:href="#stroked-calendar"></use></svg> Widgets</a></li>
			<li><a href="charts.html"><svg class="glyph stroked line-graph"><use xlink:href="#stroked-line-graph"></use></svg> Charts</a></li>
			<li><a href="tables.html"><svg class="glyph stroked table"><use xlink:href="#stroked-table"></use></svg> Tables</a></li>
			<li><a href="forms.html"><svg class="glyph stroked pencil"><use xlink:href="#stroked-pencil"></use></svg> Forms</a></li>
			<li><a href="panels.html"><svg class="glyph stroked app-window"><use xlink:href="#stroked-app-window"></use></svg> Alerts &amp; Panels</a></li>
			<li><a href="icons.html"><svg class="glyph stroked star"><use xlink:href="#stroked-star"></use></svg> Icons</a></li>
			<li class="parent ">
				<a href="#">
					<span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Dropdown 
				</a>
				<ul class="children collapse" id="sub-item-1">
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Sub Item 1
						</a>
					</li>
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Sub Item 2
						</a>
					</li>
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Sub Item 3
						</a>
					</li>
				</ul>
			</li>
			<li role="presentation" class="divider"></li>
			<li><a href="login.html"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Login Page</a></li>
		</ul>

	</div><!--/.sidebar-->
		
	<!--<div class="col-sm-12 col-sm-offset-0 col-lg-12 col-lg-offset-0 main">			
		<div class="row">
			<ol class="breadcrumb">
				<li><a href="#"><svg class="glyph stroked home"><use xlink:href="#stroked-home"></use></svg></a></li>
				<li class="active" id="breadcrumb_text">Welcome</li>
			</ol>
		</div><!--/.row-->

		<div class="modal-content" style="width:500px; left:50%; margin-left:-250px; margin-top:100px; display:none;" id="screen_appload">
            
            <div class="modal-body">
                Geeks on Wheels Javelin is loading...
            </div>
            
        </div>

        <div class="modal-content" style="width:500px; left:50%; margin-left:-250px; margin-top:100px; display:none;" id="screen_genericloading">
            
            <div class="modal-body" align="center">
                Please Wait...
            </div>
            
        </div>


        <div class="modal-content" style="width:500px; left:2%; margin-top:30px; display:none; position:fixed;" id="screen_dashboard">
            <div class="modal-header" style="overflow:auto;">
                <h4 class="modal-title" id="myModalLabel">Main Menu</h4>
            </div>
            <div class="modal-body" id="categoryListOptions" style="overflow:auto; max-height:400px;">
               Please reload from the server to show options here
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="startOnlineReload()">Online Reload</button>
            </div>
        </div>

        <div class="modal-content" style="width:96%; margin:2%; margin-top:-35px; display:none; position:fixed; height:96%; z-index:10000;" id="screen_productinfo">
            <div class="modal-header">
                <h4 class="modal-title" id="productName">Product Name</h4>
            </div>
            <div class="modal-body" id="productData" style="overflow:auto;">
               The internet monkeys are still generating dynamic content which will go here
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="showScreen('dashboard')">Close</button>
            </div>
        </div>

        <div class="modal-content" style="width:96%; margin:2%; margin-top:-35px; display:none; position:fixed; height:96%; z-index:10000;" id="screen_logout">
            <div class="modal-header">
                <h4 class="modal-title" id="">Logout</h4>
            </div>
            <div class="modal-body" id="productData" style="overflow:auto;">
               Are you sure you want to sign out? Any offline data will be deleted and you have to go back online before you are able to sign in again.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="showScreen('dashboard')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="modal-content" style="width:500px; left:50%; margin-left:-250px; margin-top:100px; display:none;" id="screen_signin">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Sign In</h4>
            </div>
            <div class="modal-body">
                <input type="email" style="width:100%;" placeholder="Email Address" class="form-control" id="UserEmailAddress"><br>
                <input type="password" style="width:100%;" placeholder="Password" class="form-control" id="UserPassword">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="startSignIn()">Sign In</button>
            </div>
        </div>
		
		<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                    </div>
                    <div class="modal-body">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

      


        <div style="position:fixed; bottom:2%; right:2%; width:30%; max-width:500px;">
        	<img src="gow.png" width="100%" height="100%"><br>Alpha Development Mode
        </div>

	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/chart.min.js"></script>
	<script src="js/chart-data.js"></script>
	<script src="js/easypiechart.js"></script>
	<script src="js/easypiechart-data.js"></script>
	<script src="js/bootstrap-datepicker.js"></script>
	<script>
		$('#calendar').datepicker({
		});

		!function ($) {
		    $(document).on("click","ul.nav li.parent > a > span.icon", function(){          
		        $(this).find('em:first').toggleClass("glyphicon-minus");      
		    }); 
		    $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
		}(window.jQuery);

		$(window).on('resize', function () {
		  if ($(window).width() > 768) $('#sidebar-collapse').collapse('show')
		})
		$(window).on('resize', function () {
		  if ($(window).width() <= 767) $('#sidebar-collapse').collapse('hide')
		})
	</script>	
</body>


<script src="phonegap.js"></script>

<script type="text/javascript">

var serverLocation = "http://bagsed-it.com/javelin2_server/";


function onAppLoad() {


// 0. show the loading screen

document.getElementById("screen_appload").style.display="";

// 0.5. Check online status::

if(navigator.onLine) {




// 1. Check login and status

$.ajax({
   type: 'GET',
    url: serverLocation + "endpoint.php?Action=checkSignIn",
    async: false,
    jsonpCallback: 'jsonCallback',
    contentType: "application/json",
    dataType: 'jsonp',
    success: function(json) {
        if(json.jsonReturns[0].returnData=="registered") {
            // We are running online and the user is not a guest. Now show the last viewed offline screen. Will go to the dashboard by default for now
            showScreen("dashboard")
            startOnlineReload();

        }
        else {
		    // We are running online and the user is a guest. Must be connected to server to sign in
			$("#screen_appload").fadeOut(500)
			document.getElementById("screen_signin").style.display="";		    
    
}
    },
    error: function(e) {
            alert("YOU ARE OFFLINE "+e.message)
            // We are running offline and will show the last viewed offline screen if available.
    
    }
});

}

else {

	// do offline startup procedure


	alert("OFFLINE");

	if(getLocalVar("javelin_signinstatus")=="registered") {

		// procede - logged in
            showScreen("dashboard")
            loadOfflineValues()

	}
	else {

		// halt - offline and not logged in

		document.getElementById("screen_appload").innerHTML="Unfortunately, you can not use this app offline if haven't yet signed in. Please go online, sign in and you will then be able to access offline data."


	}

}

   
}

function showScreen(screenname) {


	// first, stop showing all screens

	$(".modal-content").fadeOut(500);


	// then display the screenname given

	document.getElementById("screen_"+screenname).style.display=""

}

function setLocalVar(VarName,VarVal) {

	localStorage.setItem(VarName,VarVal)
}

function getLocalVar(VarName) {

    if(localStorage.getItem(VarName) === null) {

        return "nocookie";

    }
    else {

        return localStorage.getItem(VarName);
    }

}

function startOnlineReload() {

	document.getElementById("screen_genericloading").style.display=""


	// first, get a list of categories and store them in an offline storage.

	$.ajax({
	   type: 'GET',
	    url: serverLocation + "endpoint.php?Action=downloadCategories",
	    async: false,
	    jsonpCallback: 'jsonCallback',
	    contentType: "application/json",
	    dataType: 'jsonp',
	    success: function(json) {
	        
	        // now put response into JS offline storage

	        setLocalVar("javelin_categories",json.jsonReturns[0].returnData)

	        onlineReload2();


	    },
	    error: function(e) {
	            alert("CATEGORY DOWNLOAD ERROR "+e.message)
	            // There is a program error
	    
	    }
	});

	


}

function onlineReload2() {
	// now download the products



	$.ajax({
	   type: 'GET',
	    url: serverLocation + "endpoint.php?Action=downloadProducts",
	    async: false,
	    jsonpCallback: 'jsonCallback',
	    contentType: "application/json",
	    dataType: 'jsonp',
	    success: function(json) {
	        
	        // now put response into JS offline storage

	        setLocalVar("javelin_products",json.jsonReturns[0].returnData)

	       // alert("Online reload complete")

		loadOfflineValues()

	$("#screen_genericloading").fadeOut(500);



	    },
	    error: function(e) {
	            alert("PRODUCT DOWNLOAD ERROR "+e.message)
	            // There is a program error
	    
	    }
	});




	// online reload is complete.


	
}

function loadOfflineValues() {

	// first populate the product category list

	var CategoryData = getLocalVar("javelin_categories");
	var CateDataSplit = CategoryData.split(";")

	var outputData = ""

	for(i=0; i < CateDataSplit.length; i++) {

		var spliti = CateDataSplit[i].split(",")

		var CatId = spliti[0];
		var CatName = spliti[1];

		var outputData = outputData + "<button type=\"button\" class=\"btn btn-primary btn-lg btn-block\" onclick=\"displayCategory("+CatId+")\">"+CatName+"</button>";

	}

	document.getElementById("categoryListOptions").innerHTML = outputData

}


function displayCategory(catId) {

	var ProductData = getLocalVar("javelin_products");
	var ProdDataSplit = ProductData.split("~")

	var outputData = "<button type=\"button\" class=\"btn btn-primary btn-lg btn-block\" onclick=\"loadOfflineValues()\">Back to Categories</button>";

	for(i=0; i<ProdDataSplit.length;i++) {

		var spliti = ProdDataSplit[i].split(",")

		var ProductId = spliti[0];
		var DisplayName = spliti[1];
		var CategoryId = spliti[4];

		if(CategoryId==catId) {

		var outputData = outputData + "<button type=\"button\" class=\"btn btn-primary btn-lg btn-block\" onclick=\"displayProduct("+ProductId+")\">"+DisplayName+"</button>";

		}


	}

	document.getElementById("categoryListOptions").innerHTML = outputData

}

function displayProduct(givenproductId) {

	showScreen("productinfo");

	var ProductData = getLocalVar("javelin_products");
	var ProdDataSplit = ProductData.split("~")

	var outputData = "";

	for(i=0; i<ProdDataSplit.length;i++) {

		var spliti = ProdDataSplit[i].split(",")

		var ProductId = spliti[0];
		var DisplayName = spliti[1];
		var DisplayInfo = spliti[2];
		var PriceDisplay = spliti[3];
		var CategoryId = spliti[4];

		if(ProductId==givenproductId) {

			//var outputData = outputData + "<button type=\"button\" class=\"btn btn-primary btn-lg btn-block\" onclick=\"displayProduct("+ProductId+")\">"+DisplayName+"</button>";

			document.getElementById("productName").innerHTML = DisplayName

			if(PriceDisplay=="") {
				document.getElementById("productData").innerHTML = DisplayInfo
			}
			else {
				document.getElementById("productData").innerHTML = "<h4>Price: " + PriceDisplay + "</h4><hr>" + DisplayInfo
			}

		}


	}



}



function startSignIn() {

	$("#screen_signin").fadeOut(500);

	document.getElementById("screen_genericloading").style.display="";

	UserEmailAddress = document.getElementById("UserEmailAddress").value;
	UserPassword = document.getElementById("UserPassword").value;

	$.ajax({
	   type: 'GET',
	    url: serverLocation + "endpoint.php?Action=signIn&EmailAddress=" + UserEmailAddress + "&Password=" + UserPassword,
	    async: false,
	    jsonpCallback: 'jsonCallback',
	    contentType: "application/json",
	    dataType: 'jsonp',
	    success: function(json) {
	        if(json.jsonReturns[0].returnData=="success") {
	            // Sign on was successful
	            alert("SIGN ON SUCCESS")
	            setLocalVar("javelin_signinstatus","registered")
	            // go to dashboard 
	            $("#screen_genericloading").fadeOut(500);
	            document.getElementById("screen_dashboard").style.display=""
	        }
	        else {
			    // Sign on failed
			    alert("Sign on failed. Please try again")
	            setLocalVar("javelin_signinstatus","unregistered")

			    alert(json.jsonReturns[0].returnData)
				$("#screen_genericloading").fadeOut(500)
				document.getElementById("screen_signin").style.display="";		    
	    
	}
	    },
	    error: function(e) {
	            alert("ERROR "+e.message)
	            // There is a program error
	    
	    }
	});



}

function logout() {

if(navigator.onLine) {

	// do logout procedure

	$.ajax({
	   type: 'GET',
	    url: serverLocation + "endpoint.php?Action=signOut",
	    async: false,
	    jsonpCallback: 'jsonCallback',
	    contentType: "application/json",
	    dataType: 'jsonp',
	    success: function(json) {
	        if(json.jsonReturns[0].returnData=="success") {
	            // Sign out was successful
	            alert("You are now signed out")
	            setLocalVar("javelin_signinstatus","unregistered")
	            // go to dashboard 
	            $("#screen_genericloading").fadeOut(500);
				showScreen("signin")	    
	        }
	        else {
			    // Sign out failed
			    alert("There was an error signing you out. Please try again")
	            setLocalVar("javelin_signinstatus","registered")

				$("#screen_genericloading").fadeOut(500)
				showScreen("dashboard")	    
	}
	    },
	    error: function(e) {
	            alert("ERROR "+e.message)
	            // There is a program error
	    
	    }
	});

}

else {

	alert("Sorry, you can't change authentication status when you are not connected to the internet. Please go back online and then sign out");

	showScreen("dashboard")

}


}

</script>

<!--[if lt IE 9]>
<script src="js/html5shiv.js"></script>
<script src="js/respond.min.js"></script>
<![endif]-->

</html>
